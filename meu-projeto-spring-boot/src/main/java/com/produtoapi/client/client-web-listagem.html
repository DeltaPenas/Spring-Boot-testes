<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Produtos</title>
</head>
<body>
<h2>Lista de  e Clientes - HTML/JavaScript</h2>


<table id="produtosTable" border="1">
    <thead>
    <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>Pre√ßo</th>
        <th>Quantidade</th>
        <th>Status</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<table id="clientesTable" border="1">
    <thead>
    <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>CPF</th>
        <th>Telefone</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>



<!-- Total de produtos e clientes -->
<div id="totalProdutos">Total de Produtos: 0</div>
<div id="totalClientes">Todal de Clientes: 0 </div>


<!-- Mensagem de erro -->
<div id="erroMensagem" style="color: red; display: none;">
    Erro ao buscar Dados. Por favor, tente novamente mais tarde.
</div>



<script>
    function listarClientes(){
        fetch('http://localhost:8080/clientes').then(response => {
            if(!response.ok){
                throw new Error('Erro na rede: ' + response.status);
            }
            return response.json();
        })
        .then(data => {
            const tableBody = document.getElementById('clientesTable').getElementsByTagName('tbody')[0];
            let totalClientes = 0;

            data.forEach(cliente => {
                const row = tableBody.insertRow();
                const cellId = row.insertCell(0);
                const cellNome = row.insertCell(1);
                const cellCpf = row.insertCell(2);
                const cellTelefone = row.insertCell(3);

                cellId.textContent = cliente.id;
                cellNome.textContent = cliente.nome;
                cellCpf.textContent = cliente.cpf;
                cellTelefone.textContent = cliente.telefone;
                totalClientes++
            });
            document.getElementById('totalClientes').textContent = 'Total de Clientes: ' + totalClientes;
        }).catch(error => {
                console.error('Erro ao buscar Clientes:', error); // Exibe o erro no console
                
                document.getElementById('erroMensagem').style.display = 'block'; // Exibe a mensagem de erro
        });
        


    }

    function listarProdutos() {
        fetch('http://localhost:8080/produtos')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro na rede: ' + response.status);
                }
                return response.json();
            })
            .then(data => {

                const tableBody = document.getElementById('produtosTable').getElementsByTagName('tbody')[0];
                let totalProdutos = 0;

                data.forEach(produto => {
                    const row = tableBody.insertRow();
                    const cellId = row.insertCell(0);
                    const cellNome = row.insertCell(1);
                    const cellValor = row.insertCell(2);
                    const cellquant = row.insertCell(3);
                    const cellStatus = row.insertCell(4);

                    cellId.textContent = produto.id;
                    cellNome.textContent = produto.nome;
                    cellValor.textContent = produto.valor;
                    cellquant.textContent = produto.quantidade;
                    cellStatus.textContent = produto.status;
                    totalProdutos++;
                });
                // Exibe o total de produtos
                document.getElementById('totalProdutos').textContent = 'Total de Produtos: ' + totalProdutos;
            })
            .catch(error => {
                console.error('Erro ao buscar produtos:', error); // Exibe o erro no console
                // Exibe a mensagem de erro
                document.getElementById('erroMensagem').style.display = 'block'; // Exibe a mensagem de erro
            });
    }

    document.addEventListener('DOMContentLoaded', listarProdutos);
    document.addEventListener('DOMContentLoaded', listarClientes);
</script>
</body>
</html>